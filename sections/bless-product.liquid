{% liquid
  assign nalamera_product = section.settings.nalamera_product
  assign lumasara_product = section.settings.lumasara_product
  assign welamora_product = section.settings.welamora_product
  assign niraluma_product = section.settings.niraluma_product
  assign olanwela_product = section.settings.olanwela_product
  assign rakawela_product = section.settings.rakawela_product
  assign morasara_product = section.settings.morasara_product
%}

<section class="bless-split" data-split-container>
  <div class="bless-split__inner">
    <div class="bless-split__column bless-split__column--blessing" id="blessing-display-area"></div>

    <div class="bless-split__column bless-split__column--product">
      <div class="bless-product-grid">
        {% assign product = nalamera_product %}
        <article class="bless-product-card" data-sidthie-key="NALAMERA" style="display: none;">
          {% if product %}
            {% assign default_variant = product.selected_or_first_available_variant %}
            <div class="bless-product-media">
              {% assign primary_image = product.images[0] %}
              {% assign secondary_image = product.images[1] %}
              {% if primary_image %}
                <div class="bless-product-image">
                  {{
                    primary_image
                    | image_url: width: 1200
                    | image_tag:
                      widths: '400, 600, 800, 1200',
                      sizes: '(min-width: 960px) 440px, 90vw',
                      class: 'bless-product-image__img bless-product-image__img--primary',
                      alt: product.title
                  }}
                  {% if secondary_image %}
                    {{
                      secondary_image
                      | image_url: width: 1200
                      | image_tag:
                        widths: '400, 600, 800, 1200',
                        sizes: '(min-width: 960px) 440px, 90vw',
                        class: 'bless-product-image__img bless-product-image__img--secondary',
                        alt: product.title
                    }}
                  {% endif %}
                </div>
              {% endif %}
            </div>
            <h3 class="bless-product-title">{{ product.title | escape }}</h3>
            {% if default_variant %}
              <p class="bless-product-price">{{ default_variant.price | money_with_currency }}</p>
            {% endif %}
            <form method="post" action="/cart/add" class="bless-product-form">
              <label class="bless-product-label" for="VariantSelect-{{ section.id }}-NALAMERA">Choose option</label>
              <select id="VariantSelect-{{ section.id }}-NALAMERA" name="id" class="bless-product-field">
                {% for variant in product.variants %}
                  <option value="{{ variant.id }}" {% if variant.id == default_variant.id %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                    {{ variant.title }}{% unless variant.available %} — Sold out{% endunless %}
                  </option>
                {% endfor %}
              </select>

              <label class="bless-product-label" for="Quantity-{{ section.id }}-NALAMERA">Quantity</label>
              <input id="Quantity-{{ section.id }}-NALAMERA" class="bless-product-field bless-product-quantity" type="number" name="quantity" min="1" value="1">

              <button type="submit" class="bless-product-button bless-product-button--outline">Add to cart</button>
            </form>
          {% else %}
            <div class="bless-product-placeholder">Assign a product for Nalamera.</div>
          {% endif %}
        </article>

        {% assign product = lumasara_product %}
        <article class="bless-product-card" data-sidthie-key="LUMASARA" style="display: none;">
          {% if product %}
            {% assign default_variant = product.selected_or_first_available_variant %}
            <div class="bless-product-media">
              {% assign primary_image = product.images[0] %}
              {% assign secondary_image = product.images[1] %}
              {% if primary_image %}
                <div class="bless-product-image">
                  {{
                    primary_image
                    | image_url: width: 1200
                    | image_tag:
                      widths: '400, 600, 800, 1200',
                      sizes: '(min-width: 960px) 440px, 90vw',
                      class: 'bless-product-image__img bless-product-image__img--primary',
                      alt: product.title
                  }}
                  {% if secondary_image %}
                    {{
                      secondary_image
                      | image_url: width: 1200
                      | image_tag:
                        widths: '400, 600, 800, 1200',
                        sizes: '(min-width: 960px) 440px, 90vw',
                        class: 'bless-product-image__img bless-product-image__img--secondary',
                        alt: product.title
                    }}
                  {% endif %}
                </div>
              {% endif %}
            </div>
            <h3 class="bless-product-title">{{ product.title | escape }}</h3>
            {% if default_variant %}
              <p class="bless-product-price">{{ default_variant.price | money_with_currency }}</p>
            {% endif %}
            <form method="post" action="/cart/add" class="bless-product-form">
              <label class="bless-product-label" for="VariantSelect-{{ section.id }}-LUMASARA">Choose option</label>
              <select id="VariantSelect-{{ section.id }}-LUMASARA" name="id" class="bless-product-field">
                {% for variant in product.variants %}
                  <option value="{{ variant.id }}" {% if variant.id == default_variant.id %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                    {{ variant.title }}{% unless variant.available %} — Sold out{% endunless %}
                  </option>
                {% endfor %}
              </select>

              <label class="bless-product-label" for="Quantity-{{ section.id }}-LUMASARA">Quantity</label>
              <input id="Quantity-{{ section.id }}-LUMASARA" class="bless-product-field bless-product-quantity" type="number" name="quantity" min="1" value="1">

              <button type="submit" class="bless-product-button bless-product-button--outline">Add to cart</button>
            </form>
          {% else %}
            <div class="bless-product-placeholder">Assign a product for Lumasara.</div>
          {% endif %}
        </article>

        {% assign product = welamora_product %}
        <article class="bless-product-card" data-sidthie-key="WELAMORA" style="display: none;">
          {% if product %}
            {% assign default_variant = product.selected_or_first_available_variant %}
            <div class="bless-product-media">
              {% assign primary_image = product.images[0] %}
              {% assign secondary_image = product.images[1] %}
              {% if primary_image %}
                <div class="bless-product-image">
                  {{
                    primary_image
                    | image_url: width: 1200
                    | image_tag:
                      widths: '400, 600, 800, 1200',
                      sizes: '(min-width: 960px) 440px, 90vw',
                      class: 'bless-product-image__img bless-product-image__img--primary',
                      alt: product.title
                  }}
                  {% if secondary_image %}
                    {{
                      secondary_image
                      | image_url: width: 1200
                      | image_tag:
                        widths: '400, 600, 800, 1200',
                        sizes: '(min-width: 960px) 440px, 90vw',
                        class: 'bless-product-image__img bless-product-image__img--secondary',
                        alt: product.title
                    }}
                  {% endif %}
                </div>
              {% endif %}
            </div>
            <h3 class="bless-product-title">{{ product.title | escape }}</h3>
            {% if default_variant %}
              <p class="bless-product-price">{{ default_variant.price | money_with_currency }}</p>
            {% endif %}
            <form method="post" action="/cart/add" class="bless-product-form">
              <label class="bless-product-label" for="VariantSelect-{{ section.id }}-WELAMORA">Choose option</label>
              <select id="VariantSelect-{{ section.id }}-WELAMORA" name="id" class="bless-product-field">
                {% for variant in product.variants %}
                  <option value="{{ variant.id }}" {% if variant.id == default_variant.id %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                    {{ variant.title }}{% unless variant.available %} — Sold out{% endunless %}
                  </option>
                {% endfor %}
              </select>

              <label class="bless-product-label" for="Quantity-{{ section.id }}-WELAMORA">Quantity</label>
              <input id="Quantity-{{ section.id }}-WELAMORA" class="bless-product-field bless-product-quantity" type="number" name="quantity" min="1" value="1">

              <button type="submit" class="bless-product-button bless-product-button--outline">Add to cart</button>
            </form>
          {% else %}
            <div class="bless-product-placeholder">Assign a product for Welamora.</div>
          {% endif %}
        </article>

        {% assign product = niraluma_product %}
        <article class="bless-product-card" data-sidthie-key="NIRALUMA" style="display: none;">
          {% if product %}
            {% assign default_variant = product.selected_or_first_available_variant %}
            <div class="bless-product-media">
              {% assign primary_image = product.images[0] %}
              {% assign secondary_image = product.images[1] %}
              {% if primary_image %}
                <div class="bless-product-image">
                  {{
                    primary_image
                    | image_url: width: 1200
                    | image_tag:
                      widths: '400, 600, 800, 1200',
                      sizes: '(min-width: 960px) 440px, 90vw',
                      class: 'bless-product-image__img bless-product-image__img--primary',
                      alt: product.title
                  }}
                  {% if secondary_image %}
                    {{
                      secondary_image
                      | image_url: width: 1200
                      | image_tag:
                        widths: '400, 600, 800, 1200',
                        sizes: '(min-width: 960px) 440px, 90vw',
                        class: 'bless-product-image__img bless-product-image__img--secondary',
                        alt: product.title
                    }}
                  {% endif %}
                </div>
              {% endif %}
            </div>
            <h3 class="bless-product-title">{{ product.title | escape }}</h3>
            {% if default_variant %}
              <p class="bless-product-price">{{ default_variant.price | money_with_currency }}</p>
            {% endif %}
            <form method="post" action="/cart/add" class="bless-product-form">
              <label class="bless-product-label" for="VariantSelect-{{ section.id }}-NIRALUMA">Choose option</label>
              <select id="VariantSelect-{{ section.id }}-NIRALUMA" name="id" class="bless-product-field">
                {% for variant in product.variants %}
                  <option value="{{ variant.id }}" {% if variant.id == default_variant.id %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                    {{ variant.title }}{% unless variant.available %} — Sold out{% endunless %}
                  </option>
                {% endfor %}
              </select>

              <label class="bless-product-label" for="Quantity-{{ section.id }}-NIRALUMA">Quantity</label>
              <input id="Quantity-{{ section.id }}-NIRALUMA" class="bless-product-field bless-product-quantity" type="number" name="quantity" min="1" value="1">

              <button type="submit" class="bless-product-button bless-product-button--outline">Add to cart</button>
            </form>
          {% else %}
            <div class="bless-product-placeholder">Assign a product for Niraluma.</div>
          {% endif %}
        </article>

        {% assign product = olanwela_product %}
        <article class="bless-product-card" data-sidthie-key="OLANWELA" style="display: none;">
          {% if product %}
            {% assign default_variant = product.selected_or_first_available_variant %}
            <div class="bless-product-media">
              {% assign primary_image = product.images[0] %}
              {% assign secondary_image = product.images[1] %}
              {% if primary_image %}
                <div class="bless-product-image">
                  {{
                    primary_image
                    | image_url: width: 1200
                    | image_tag:
                      widths: '400, 600, 800, 1200',
                      sizes: '(min-width: 960px) 440px, 90vw',
                      class: 'bless-product-image__img bless-product-image__img--primary',
                      alt: product.title
                  }}
                  {% if secondary_image %}
                    {{
                      secondary_image
                      | image_url: width: 1200
                      | image_tag:
                        widths: '400, 600, 800, 1200',
                        sizes: '(min-width: 960px) 440px, 90vw',
                        class: 'bless-product-image__img bless-product-image__img--secondary',
                        alt: product.title
                    }}
                  {% endif %}
                </div>
              {% endif %}
            </div>
            <h3 class="bless-product-title">{{ product.title | escape }}</h3>
            {% if default_variant %}
              <p class="bless-product-price">{{ default_variant.price | money_with_currency }}</p>
            {% endif %}
            <form method="post" action="/cart/add" class="bless-product-form">
              <label class="bless-product-label" for="VariantSelect-{{ section.id }}-OLANWELA">Choose option</label>
              <select id="VariantSelect-{{ section.id }}-OLANWELA" name="id" class="bless-product-field">
                {% for variant in product.variants %}
                  <option value="{{ variant.id }}" {% if variant.id == default_variant.id %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                    {{ variant.title }}{% unless variant.available %} — Sold out{% endunless %}
                  </option>
                {% endfor %}
              </select>

              <label class="bless-product-label" for="Quantity-{{ section.id }}-OLANWELA">Quantity</label>
              <input id="Quantity-{{ section.id }}-OLANWELA" class="bless-product-field bless-product-quantity" type="number" name="quantity" min="1" value="1">

              <button type="submit" class="bless-product-button bless-product-button--outline">Add to cart</button>
            </form>
          {% else %}
            <div class="bless-product-placeholder">Assign a product for Olanwela.</div>
          {% endif %}
        </article>

        {% assign product = rakawela_product %}
        <article class="bless-product-card" data-sidthie-key="RAKAWELA" style="display: none;">
          {% if product %}
            {% assign default_variant = product.selected_or_first_available_variant %}
            <div class="bless-product-media">
              {% assign primary_image = product.images[0] %}
              {% assign secondary_image = product.images[1] %}
              {% if primary_image %}
                <div class="bless-product-image">
                  {{
                    primary_image
                    | image_url: width: 1200
                    | image_tag:
                      widths: '400, 600, 800, 1200',
                      sizes: '(min-width: 960px) 440px, 90vw',
                      class: 'bless-product-image__img bless-product-image__img--primary',
                      alt: product.title
                  }}
                  {% if secondary_image %}
                    {{
                      secondary_image
                      | image_url: width: 1200
                      | image_tag:
                        widths: '400, 600, 800, 1200',
                        sizes: '(min-width: 960px) 440px, 90vw',
                        class: 'bless-product-image__img bless-product-image__img--secondary',
                        alt: product.title
                    }}
                  {% endif %}
                </div>
              {% endif %}
            </div>
            <h3 class="bless-product-title">{{ product.title | escape }}</h3>
            {% if default_variant %}
              <p class="bless-product-price">{{ default_variant.price | money_with_currency }}</p>
            {% endif %}
            <form method="post" action="/cart/add" class="bless-product-form">
              <label class="bless-product-label" for="VariantSelect-{{ section.id }}-RAKAWELA">Choose option</label>
              <select id="VariantSelect-{{ section.id }}-RAKAWELA" name="id" class="bless-product-field">
                {% for variant in product.variants %}
                  <option value="{{ variant.id }}" {% if variant.id == default_variant.id %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                    {{ variant.title }}{% unless variant.available %} — Sold out{% endunless %}
                  </option>
                {% endfor %}
              </select>

              <label class="bless-product-label" for="Quantity-{{ section.id }}-RAKAWELA">Quantity</label>
              <input id="Quantity-{{ section.id }}-RAKAWELA" class="bless-product-field bless-product-quantity" type="number" name="quantity" min="1" value="1">

              <button type="submit" class="bless-product-button bless-product-button--outline">Add to cart</button>
            </form>
          {% else %}
            <div class="bless-product-placeholder">Assign a product for Rakawela.</div>
          {% endif %}
        </article>

        {% assign product = morasara_product %}
        <article class="bless-product-card" data-sidthie-key="MORASARA" style="display: none;">
          {% if product %}
            {% assign default_variant = product.selected_or_first_available_variant %}
            <div class="bless-product-media">
              {% assign primary_image = product.images[0] %}
              {% assign secondary_image = product.images[1] %}
              {% if primary_image %}
                <div class="bless-product-image">
                  {{
                    primary_image
                    | image_url: width: 1200
                    | image_tag:
                      widths: '400, 600, 800, 1200',
                      sizes: '(min-width: 960px) 440px, 90vw',
                      class: 'bless-product-image__img bless-product-image__img--primary',
                      alt: product.title
                  }}
                  {% if secondary_image %}
                    {{
                      secondary_image
                      | image_url: width: 1200
                      | image_tag:
                        widths: '400, 600, 800, 1200',
                        sizes: '(min-width: 960px) 440px, 90vw',
                        class: 'bless-product-image__img bless-product-image__img--secondary',
                        alt: product.title
                    }}
                  {% endif %}
                </div>
              {% endif %}
            </div>
            <h3 class="bless-product-title">{{ product.title | escape }}</h3>
            {% if default_variant %}
              <p class="bless-product-price">{{ default_variant.price | money_with_currency }}</p>
            {% endif %}
            <form method="post" action="/cart/add" class="bless-product-form">
              <label class="bless-product-label" for="VariantSelect-{{ section.id }}-MORASARA">Choose option</label>
              <select id="VariantSelect-{{ section.id }}-MORASARA" name="id" class="bless-product-field">
                {% for variant in product.variants %}
                  <option value="{{ variant.id }}" {% if variant.id == default_variant.id %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                    {{ variant.title }}{% unless variant.available %} — Sold out{% endunless %}
                  </option>
                {% endfor %}
              </select>

              <label class="bless-product-label" for="Quantity-{{ section.id }}-MORASARA">Quantity</label>
              <input id="Quantity-{{ section.id }}-MORASARA" class="bless-product-field bless-product-quantity" type="number" name="quantity" min="1" value="1">

              <button type="submit" class="bless-product-button bless-product-button--outline">Add to cart</button>
            </form>
          {% else %}
            <div class="bless-product-placeholder">Assign a product for Morasara.</div>
          {% endif %}
        </article>
      </div>
    </div>
  </div>
</section>

{% stylesheet %}
.bless-split {
  padding: clamp(2rem, 5vw, 4rem) 0;
  color: #ffffff;
}

.bless-split__inner {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
}

.bless-split__column {
  flex: 1 1 300px;
  min-width: 280px;
  background: rgba(20, 20, 20, 0.6);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 40px;
  backdrop-filter: blur(10px);
  color: #ffffff;
}

.bless-split__column--blessing {
  order: 1;
  font-family: 'Cardo', serif;
  font-size: clamp(1.4rem, 2vw + 1rem, 2.2rem);
  line-height: 1.5;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
}

.bless-split__column--product {
  order: 2;
}

@media (min-width: 900px) {
  .bless-split__column--blessing,
  .bless-split__column--product {
    flex: 0 0 calc(50% - 0.75rem);
  }
}

@media (max-width: 768px) {
  .bless-split__column--blessing { order: 1; }
  .bless-split__column--product { order: 2; }
}

.bless-product-grid {
  display: grid;
}

.bless-product-card {
  background: rgba(20, 20, 20, 0.6);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 0;
  color: #ffffff;
}

.bless-product-media {
  margin-bottom: 1rem;
}

.bless-product-image {
  position: relative;
  overflow: hidden;
  border-radius: 12px;
}

.bless-product-image__img {
  width: 100%;
  display: block;
  height: auto;
  transition: opacity 200ms ease;
}

.bless-product-image__img--secondary {
  position: absolute;
  inset: 0;
  opacity: 0;
}

.bless-product-image:hover .bless-product-image__img--secondary {
  opacity: 1;
}

.bless-product-image:hover .bless-product-image__img--primary {
  opacity: 0;
}

.bless-product-title {
  margin: 0 0 0.35rem;
  font-size: 1.25rem;
  font-family: 'Cardo', serif;
  color: #ffffff;
}

.bless-product-price {
  margin: 0 0 1rem;
  font-weight: 700;
  color: #ffffff;
}

.bless-product-form {
  display: grid;
  gap: 0.75rem;
}

.bless-product-label {
  font-size: 0.95rem;
  font-weight: 600;
  color: #ffffff;
}

.bless-product-field {
  width: 100%;
  padding: 0.7rem 0.9rem;
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.35);
  background: transparent;
  color: #ffffff;
}

.bless-product-quantity {
  appearance: textfield;
}

.bless-product-quantity::-webkit-outer-spin-button,
.bless-product-quantity::-webkit-inner-spin-button {
  appearance: none;
  margin: 0;
}

.bless-product-button {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  padding: 0.85rem 1.4rem;
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.8);
  background: transparent;
  color: #ffffff;
  font-weight: 700;
  cursor: pointer;
  transition: background-color 150ms ease, transform 150ms ease;
}

.bless-product-button:hover,
.bless-product-button:focus {
  background: rgba(255, 255, 255, 0.1);
  transform: translateY(-1px);
}

.bless-product-placeholder {
  color: rgba(255, 255, 255, 0.75);
}
{% endstylesheet %}

{% javascript %}
document.addEventListener('DOMContentLoaded', () => {
  const blessingArea = document.getElementById('blessing-display-area');
  const blessedText = sessionStorage.getItem('blessed_text');
  const sidthieKey = (new URLSearchParams(window.location.search).get('sidthie') || '').toUpperCase();

  if (blessingArea) {
    const content = blessedText || 'Your blessing waits quietly. Continue your journey to see it unfold.';
    blessingArea.textContent = content;
  }

  const productCards = document.querySelectorAll('[data-sidthie-key]');
  productCards.forEach((card) => {
    if (card instanceof HTMLElement) {
      card.style.display = 'none';
      if (card.dataset.sidthieKey === sidthieKey) {
        card.style.display = 'block';
      }
    }
  });
});
{% endjavascript %}

{% schema %}
{
  "name": "Bless product",
  "settings": [
    {
      "type": "product",
      "id": "nalamera_product",
      "label": "Nalamera product"
    },
    {
      "type": "product",
      "id": "lumasara_product",
      "label": "Lumasara product"
    },
    {
      "type": "product",
      "id": "welamora_product",
      "label": "Welamora product"
    },
    {
      "type": "product",
      "id": "niraluma_product",
      "label": "Niraluma product"
    },
    {
      "type": "product",
      "id": "olanwela_product",
      "label": "Olanwela product"
    },
    {
      "type": "product",
      "id": "rakawela_product",
      "label": "Rakawela product"
    },
    {
      "type": "product",
      "id": "morasara_product",
      "label": "Morasara product"
    }
  ],
  "presets": [
    {
      "name": "Bless product"
    }
  ]
}
{% endschema %}

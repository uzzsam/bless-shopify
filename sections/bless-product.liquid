{% liquid
  assign heading = section.settings.heading | default: 'Your Sidthie necklace'
  assign nalamera_product = section.settings.nalamera_product
  assign lumasara_product = section.settings.lumasara_product
  assign welamora_product = section.settings.welamora_product
  assign niraluma_product = section.settings.niraluma_product
  assign olanwela_product = section.settings.olanwela_product
  assign rakawela_product = section.settings.rakawela_product
  assign morasara_product = section.settings.morasara_product
%}

<section class="bless-product" data-bless-product-section>
  <div class="bless-product__header">
    <h2 class="bless-product__heading">{{ heading | escape }}</h2>
    <p class="bless-product__subtitle" data-name-target hidden></p>
  </div>

  <div class="bless-product__loading" data-loading>
    <div class="bless-product__spinner" aria-hidden="true"></div>
    <p class="bless-product__loading-text">Loading your necklace...</p>
  </div>

  <div class="bless-product__fallback" data-fallback hidden>
    <p class="bless-product__fallback-text">
      We could not find a Sidthie in your link. You can still explore every necklace below.
    </p>
    <button type="button" class="bless-product__button bless-product__button--ghost" data-view-all-toggle>
      View all necklaces
    </button>
  </div>

  <div class="bless-product__grid" data-product-grid>
    {% assign product = nalamera_product %}
    <article class="bless-product__item sidthie-product-wrapper" data-sidthie-key="NALAMERA" style="display: none;">
      <p class="bless-product__badge">NALAMERA</p>
      {% if product %}
        {% assign default_variant = product.selected_or_first_available_variant %}
        <div class="bless-product__media">
          {% if product.featured_image %}
            {{
              product.featured_image
              | image_url: width: 960
              | image_tag:
                widths: '360, 540, 720, 900',
                sizes: '(min-width: 768px) 320px, 80vw',
                class: 'bless-product__image',
                alt: product.title
            }}
          {% else %}
            <div class="bless-product__placeholder">Image coming soon</div>
          {% endif %}
        </div>
        <h3 class="bless-product__title">{{ product.title | escape }}</h3>
        {% if default_variant %}
          <p class="bless-product__price">{{ default_variant.price | money_with_currency }}</p>
        {% endif %}
        <a class="bless-product__button" href="{{ product.url }}">View product</a>
      {% else %}
        <div class="bless-product__placeholder bless-product__placeholder--empty">Assign a product for this Sidthie.</div>
      {% endif %}
    </article>

    {% assign product = lumasara_product %}
    <article class="bless-product__item sidthie-product-wrapper" data-sidthie-key="LUMASARA" style="display: none;">
      <p class="bless-product__badge">LUMASARA</p>
      {% if product %}
        {% assign default_variant = product.selected_or_first_available_variant %}
        <div class="bless-product__media">
          {% if product.featured_image %}
            {{
              product.featured_image
              | image_url: width: 960
              | image_tag:
                widths: '360, 540, 720, 900',
                sizes: '(min-width: 768px) 320px, 80vw',
                class: 'bless-product__image',
                alt: product.title
            }}
          {% else %}
            <div class="bless-product__placeholder">Image coming soon</div>
          {% endif %}
        </div>
        <h3 class="bless-product__title">{{ product.title | escape }}</h3>
        {% if default_variant %}
          <p class="bless-product__price">{{ default_variant.price | money_with_currency }}</p>
        {% endif %}
        <a class="bless-product__button" href="{{ product.url }}">View product</a>
      {% else %}
        <div class="bless-product__placeholder bless-product__placeholder--empty">Assign a product for this Sidthie.</div>
      {% endif %}
    </article>

    {% assign product = welamora_product %}
    <article class="bless-product__item sidthie-product-wrapper" data-sidthie-key="WELAMORA" style="display: none;">
      <p class="bless-product__badge">WELAMORA</p>
      {% if product %}
        {% assign default_variant = product.selected_or_first_available_variant %}
        <div class="bless-product__media">
          {% if product.featured_image %}
            {{
              product.featured_image
              | image_url: width: 960
              | image_tag:
                widths: '360, 540, 720, 900',
                sizes: '(min-width: 768px) 320px, 80vw',
                class: 'bless-product__image',
                alt: product.title
            }}
          {% else %}
            <div class="bless-product__placeholder">Image coming soon</div>
          {% endif %}
        </div>
        <h3 class="bless-product__title">{{ product.title | escape }}</h3>
        {% if default_variant %}
          <p class="bless-product__price">{{ default_variant.price | money_with_currency }}</p>
        {% endif %}
        <a class="bless-product__button" href="{{ product.url }}">View product</a>
      {% else %}
        <div class="bless-product__placeholder bless-product__placeholder--empty">Assign a product for this Sidthie.</div>
      {% endif %}
    </article>

    {% assign product = niraluma_product %}
    <article class="bless-product__item sidthie-product-wrapper" data-sidthie-key="NIRALUMA" style="display: none;">
      <p class="bless-product__badge">NIRALUMA</p>
      {% if product %}
        {% assign default_variant = product.selected_or_first_available_variant %}
        <div class="bless-product__media">
          {% if product.featured_image %}
            {{
              product.featured_image
              | image_url: width: 960
              | image_tag:
                widths: '360, 540, 720, 900',
                sizes: '(min-width: 768px) 320px, 80vw',
                class: 'bless-product__image',
                alt: product.title
            }}
          {% else %}
            <div class="bless-product__placeholder">Image coming soon</div>
          {% endif %}
        </div>
        <h3 class="bless-product__title">{{ product.title | escape }}</h3>
        {% if default_variant %}
          <p class="bless-product__price">{{ default_variant.price | money_with_currency }}</p>
        {% endif %}
        <a class="bless-product__button" href="{{ product.url }}">View product</a>
      {% else %}
        <div class="bless-product__placeholder bless-product__placeholder--empty">Assign a product for this Sidthie.</div>
      {% endif %}
    </article>

    {% assign product = olanwela_product %}
    <article class="bless-product__item sidthie-product-wrapper" data-sidthie-key="OLANWELA" style="display: none;">
      <p class="bless-product__badge">OLANWELA</p>
      {% if product %}
        {% assign default_variant = product.selected_or_first_available_variant %}
        <div class="bless-product__media">
          {% if product.featured_image %}
            {{
              product.featured_image
              | image_url: width: 960
              | image_tag:
                widths: '360, 540, 720, 900',
                sizes: '(min-width: 768px) 320px, 80vw',
                class: 'bless-product__image',
                alt: product.title
            }}
          {% else %}
            <div class="bless-product__placeholder">Image coming soon</div>
          {% endif %}
        </div>
        <h3 class="bless-product__title">{{ product.title | escape }}</h3>
        {% if default_variant %}
          <p class="bless-product__price">{{ default_variant.price | money_with_currency }}</p>
        {% endif %}
        <a class="bless-product__button" href="{{ product.url }}">View product</a>
      {% else %}
        <div class="bless-product__placeholder bless-product__placeholder--empty">Assign a product for this Sidthie.</div>
      {% endif %}
    </article>

    {% assign product = rakawela_product %}
    <article class="bless-product__item sidthie-product-wrapper" data-sidthie-key="RAKAWELA" style="display: none;">
      <p class="bless-product__badge">RAKAWELA</p>
      {% if product %}
        {% assign default_variant = product.selected_or_first_available_variant %}
        <div class="bless-product__media">
          {% if product.featured_image %}
            {{
              product.featured_image
              | image_url: width: 960
              | image_tag:
                widths: '360, 540, 720, 900',
                sizes: '(min-width: 768px) 320px, 80vw',
                class: 'bless-product__image',
                alt: product.title
            }}
          {% else %}
            <div class="bless-product__placeholder">Image coming soon</div>
          {% endif %}
        </div>
        <h3 class="bless-product__title">{{ product.title | escape }}</h3>
        {% if default_variant %}
          <p class="bless-product__price">{{ default_variant.price | money_with_currency }}</p>
        {% endif %}
        <a class="bless-product__button" href="{{ product.url }}">View product</a>
      {% else %}
        <div class="bless-product__placeholder bless-product__placeholder--empty">Assign a product for this Sidthie.</div>
      {% endif %}
    </article>

    {% assign product = morasara_product %}
    <article class="bless-product__item sidthie-product-wrapper" data-sidthie-key="MORASARA" style="display: none;">
      <p class="bless-product__badge">MORASARA</p>
      {% if product %}
        {% assign default_variant = product.selected_or_first_available_variant %}
        <div class="bless-product__media">
          {% if product.featured_image %}
            {{
              product.featured_image
              | image_url: width: 960
              | image_tag:
                widths: '360, 540, 720, 900',
                sizes: '(min-width: 768px) 320px, 80vw',
                class: 'bless-product__image',
                alt: product.title
            }}
          {% else %}
            <div class="bless-product__placeholder">Image coming soon</div>
          {% endif %}
        </div>
        <h3 class="bless-product__title">{{ product.title | escape }}</h3>
        {% if default_variant %}
          <p class="bless-product__price">{{ default_variant.price | money_with_currency }}</p>
        {% endif %}
        <a class="bless-product__button" href="{{ product.url }}">View product</a>
      {% else %}
        <div class="bless-product__placeholder bless-product__placeholder--empty">Assign a product for this Sidthie.</div>
      {% endif %}
    </article>
  </div>
</section>

{% # theme-check-disable StaticStylesheetAndJavascriptTags %}
{% stylesheet %}
.bless-product {
  padding: clamp(2.5rem, 6vw, 4.5rem) 0;
  color: #0f1b1c;
}

.bless-product__header {
  text-align: center;
  margin-bottom: 1.5rem;
}

.bless-product__heading {
  font-family: var(--font-heading, 'Cardo', serif);
  font-size: clamp(2rem, 2vw + 1rem, 2.8rem);
  margin: 0 0 0.25rem;
}

.bless-product__subtitle {
  margin: 0;
  font-family: var(--font-body, 'Albert Sans', sans-serif);
  color: rgba(15, 27, 28, 0.7);
}

.bless-product__loading {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  justify-content: center;
  padding: 1rem 0;
}

.bless-product__spinner {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 3px solid rgba(15, 27, 28, 0.1);
  border-top-color: rgba(15, 27, 28, 0.9);
  animation: bless-spin 1s linear infinite;
}

.bless-product__loading-text {
  margin: 0;
  font-family: var(--font-body, 'Albert Sans', sans-serif);
  color: rgba(15, 27, 28, 0.8);
}

.bless-product__fallback {
  text-align: center;
  margin-bottom: 1.5rem;
}

.bless-product__fallback-text {
  margin: 0 0 0.75rem;
  color: rgba(15, 27, 28, 0.8);
}

.bless-product__grid {
  display: grid;
  gap: 1.5rem;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
}

.bless-product__item {
  background: #fff;
  border-radius: 20px;
  padding: 1.25rem;
  box-shadow: 0 18px 38px rgba(0, 0, 0, 0.08);
  border: 1px solid rgba(15, 27, 28, 0.08);
  text-align: center;
}

.sidthie-product-wrapper {
  max-width: 500px;
  margin: 0 auto;
  padding: 20px;
}

.bless-product__badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  padding: 0.35rem 0.75rem;
  border-radius: 999px;
  font-size: 0.85rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  background: rgba(23, 95, 75, 0.08);
  color: #175f4b;
  margin: 0 0 0.75rem;
}

.bless-product__media {
  width: 100%;
  border-radius: 16px;
  overflow: hidden;
  background: #f4f4ef;
  display: grid;
  place-items: center;
  margin-bottom: 0.75rem;
}

.bless-product__image {
  width: 100%;
  height: auto;
  object-fit: cover;
  display: block;
}

.bless-product__placeholder {
  font-family: var(--font-body, 'Albert Sans', sans-serif);
  color: rgba(15, 27, 28, 0.5);
}

.bless-product__placeholder--empty {
  padding: 1rem;
  border-radius: 12px;
  border: 1px dashed rgba(15, 27, 28, 0.25);
  background: rgba(15, 27, 28, 0.02);
}

.bless-product__title {
  margin: 0 0 0.35rem;
  font-size: 1.1rem;
  font-family: var(--font-heading, 'Cardo', serif);
}

.bless-product__price {
  margin: 0 0 0.85rem;
  font-weight: 700;
  color: #1f2a2b;
  font-family: var(--font-body, 'Albert Sans', sans-serif);
}

.bless-product__button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem 1.4rem;
  border-radius: 999px;
  border: none;
  background: #175f4b;
  color: #fff;
  font-weight: 700;
  text-decoration: none;
  cursor: pointer;
  transition: transform 150ms ease, box-shadow 150ms ease;
}

.bless-product__button:hover,
.bless-product__button:focus {
  transform: translateY(-1px);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.16);
}

.bless-product__button--ghost {
  background: transparent;
  color: #175f4b;
  border: 1px solid rgba(23, 95, 75, 0.3);
}

@keyframes bless-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
{% endstylesheet %}

{% javascript %}
(function () {
  const section = document.querySelector('[data-bless-product-section]');
  if (!section) return;

  const wrappers = Array.from(section.querySelectorAll('[data-sidthie-key]'));
  const loading = section.querySelector('[data-loading]');
  const fallback = section.querySelector('[data-fallback]');
  const viewAllButton = section.querySelector('[data-view-all-toggle]');
  const nameTarget = section.querySelector('[data-name-target]');

  const params = new URLSearchParams(window.location.search);
  const sidthieParam = (params.get('sidthie') || '').trim();
  const nameParam = (params.get('name') || '').trim();
  const normalizedKey = sidthieParam.toUpperCase();

  if (nameParam && nameTarget) {
    nameTarget.textContent = `For ${nameParam}`;
    nameTarget.hidden = false;
  }

  const matchingWrapper = normalizedKey
    ? wrappers.find((wrapper) => wrapper.dataset.sidthieKey === normalizedKey)
    : null;

  if (matchingWrapper) {
    matchingWrapper.style.display = 'block';
  } else if (fallback) {
    fallback.hidden = false;
  }

  if (viewAllButton) {
    viewAllButton.addEventListener('click', () => {
      wrappers.forEach((wrapper) => {
        wrapper.style.display = 'block';
      });
      if (fallback) fallback.hidden = true;
    });
  }

  if (loading) loading.hidden = true;
})();
{% endjavascript %}
{% # theme-check-enable StaticStylesheetAndJavascriptTags %}

{% schema %}
{
  "name": "Bless product",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Your Sidthie necklace"
    },
    {
      "type": "product",
      "id": "nalamera_product",
      "label": "Nalamera product"
    },
    {
      "type": "product",
      "id": "lumasara_product",
      "label": "Lumasara product"
    },
    {
      "type": "product",
      "id": "welamora_product",
      "label": "Welamora product"
    },
    {
      "type": "product",
      "id": "niraluma_product",
      "label": "Niraluma product"
    },
    {
      "type": "product",
      "id": "olanwela_product",
      "label": "Olanwela product"
    },
    {
      "type": "product",
      "id": "rakawela_product",
      "label": "Rakawela product"
    },
    {
      "type": "product",
      "id": "morasara_product",
      "label": "Morasara product"
    }
  ],
  "presets": [
    {
      "name": "Bless product"
    }
  ]
}
{% endschema %}
